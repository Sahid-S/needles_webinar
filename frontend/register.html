<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - Fashion Business Webinar</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@275;300;400;500;600;700;900&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/global.css">
  <style>
    .registration-section {
        padding: 60px 0 80px;
        min-height: calc(100vh - 120px);
    }
    
    .registration-header {
        text-align: center;
        margin-bottom: 50px;
    }
    
    .registration-header h1 {
        margin-bottom: 15px;
    }
    
    .registration-header p {
        font-family: 'Roboto', sans-serif;
        font-size: 18px;
        color: var(--text-light);
        max-width: 600px;
        margin: 0 auto;
    }
    
    .registration-card {
        background-color: var(--bg-light);
        border: 1px solid #e9e9e9;
        border-radius: 20px;
        padding: 50px;
        max-width: 700px;
        margin: 0 auto;
        box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.08);
    }
    
    .form-section-title {
        font-family: 'Poppins', sans-serif;
        font-size: 24px;
        font-weight: 600;
        color: var(--primary-color);
        margin: 0 0 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--bg-light-blue);
    }
    
    .form-group {
        margin-bottom: 25px;
    }
    
    .form-label {
        display: block;
        font-family: 'Poppins', sans-serif;
        font-size: 16px;
        font-weight: 500;
        color: var(--text-dark);
        margin-bottom: 8px;
    }
    
    .form-label .required {
        color: #e74c3c;
        margin-left: 3px;
    }
    
    .form-input,
    .form-select,
    .form-textarea {
        width: 100%;
        padding: 14px 18px;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        color: var(--text-light);
        background-color: var(--bg-off-white);
        border: 2px solid #e9e9e9;
        border-radius: 10px;
        transition: border-color 0.3s ease, background-color 0.3s ease;
        box-sizing: border-box;
    }
    
    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        background-color: var(--bg-light);
    }
    
    .form-input::placeholder {
        color: #999;
    }
    
    .form-textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .checkbox-group {
        margin-top: 30px;
        margin-bottom: 30px;
    }
    
    .checkbox-wrapper {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 15px;
    }
    
    .checkbox-input {
        width: 20px;
        height: 20px;
        margin-top: 2px;
        cursor: pointer;
        accent-color: var(--primary-color);
    }
    
    .checkbox-label {
        font-family: 'Roboto', sans-serif;
        font-size: 14px;
        line-height: 1.5;
        color: var(--text-light);
        cursor: pointer;
    }
    
    .checkbox-label a {
        color: var(--primary-color);
        text-decoration: underline;
    }
    
    .checkbox-label a:hover {
        color: var(--text-dark);
    }
    
    .error-message {
        color: #e74c3c;
        font-family: 'Roboto', sans-serif;
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }
    
    .form-input.error,
    .form-select.error,
    .form-textarea.error {
        border-color: #e74c3c;
    }
    
    .btn-send-otp {
        padding: 14px 20px;
        font-family: 'Roboto', sans-serif;
        font-size: 14px;
        font-weight: 600;
        background: #006478;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        min-width: 120px;
    }
    
    .btn-send-otp:hover:not(:disabled) {
        background: #004d5c;
        transform: translateY(-1px);
    }
    
    .btn-send-otp:disabled {
        background: #ccc;
        cursor: not-allowed;
    }
    
    .btn-verify-otp {
        padding: 12px 20px;
        font-family: 'Roboto', sans-serif;
        font-size: 14px;
        font-weight: 600;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 8px;
    }
    
    .btn-verify-otp:hover:not(:disabled) {
        background: #218838;
    }
    
    .btn-verify-otp:disabled {
        background: #ccc;
        cursor: not-allowed;
    }
    
    .payment-section {
        background-color: var(--bg-light-blue);
        padding: 40px;
        border-radius: 16px;
        margin-top: 40px;
        text-align: center;
    }
    
    .payment-title {
        font-family: 'Poppins', sans-serif;
        font-size: 28px;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0 0 15px;
    }
    
    .payment-amount {
        font-family: 'Poppins', sans-serif;
        font-size: 48px;
        font-weight: 900;
        color: var(--primary-color);
        margin: 0 0 10px;
    }
    
    .payment-description {
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        color: var(--text-light);
        margin: 0 0 30px;
    }
    
    .payment-features {
        text-align: left;
        max-width: 500px;
        margin: 0 auto 30px;
    }
    
    .payment-feature {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
        font-family: 'Roboto', sans-serif;
        font-size: 15px;
        color: var(--text-light);
    }
    
    .payment-feature::before {
        content: '✓';
        width: 24px;
        height: 24px;
        background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: var(--bg-light);
        flex-shrink: 0;
    }
    
    .btn-submit {
        background: linear-gradient(99deg, #fee901 2.46%, #006478 97.81%);
        border: none;
        border-radius: 80px;
        box-shadow: 0px 0px 20px 0px rgba(9, 9, 9, 0.43);
        padding: 18px 60px;
        color: var(--bg-light);
        font-family: 'Roboto', sans-serif;
        font-weight: 700;
        font-size: 20px;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        width: 100%;
        max-width: 400px;
    }
    
    .btn-submit:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: 0px 0px 30px 0px rgba(9, 9, 9, 0.5);
    }
    
    .btn-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-family: 'Poppins', sans-serif;
        font-size: 16px;
        font-weight: 500;
        color: var(--primary-color);
        background-color: var(--bg-off-white);
        border: 2px solid var(--primary-color);
        border-radius: 50px;
        padding: 12px 20px;
        margin-bottom: 30px;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,100,120,0.1);
    }
    
    .back-link:hover {
        background-color: var(--primary-color);
        color: var(--bg-light);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,100,120,0.2);
    }
    
    .back-link::before {
        content: '←';
        font-size: 18px;
        font-weight: 700;
        transition: transform 0.3s ease;
    }
    
    .back-link:hover::before {
        transform: translateX(-3px);
    }
    
    .site-footer {
        background-color: var(--bg-light);
        padding: 50px 0;
        border-top: 1px solid #e0e0e0;
    }
    .site-footer .container {
        text-align: center;
        font-family: 'Poppins', sans-serif;
    }
    .copyright {
        font-weight: 700;
        font-size: 16px;
        color: #000000;
        margin: 0 0 15px;
    }
    .disclaimer {
        font-weight: 400;
        font-size: 14px;
        line-height: 1.6;
        color: #000000;
        max-width: 1076px;
        margin: 0 auto;
    }
    .disclaimer a {
        color: #0d6efd;
        text-decoration: underline;
    }
    
    @media (max-width: 768px) {
        .registration-card {
            padding: 30px 20px;
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .payment-section {
            padding: 30px 20px;
        }
        
        .payment-amount {
            font-size: 36px;
        }
        
        .btn-submit {
            padding: 15px 40px;
            font-size: 18px;
        }
    }
  </style>
</head>
<body>
<div class="page-wrapper">
    <section class="registration-section">
        <div class="container">
            <a href="index.html" class="back-link">Back to Home</a>
            
            <div class="registration-header">
                <h1>Register for the Webinar</h1>
                <p>Fill in your details below to secure your spot in the Fashion Business Webinar</p>
            </div>
            
            <div class="registration-card">
                <form id="registration-form">
                    <h2 class="form-section-title">Personal Information</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName" class="form-label">First Name<span class="required">*</span></label>
                            <input type="text" id="firstName" name="firstName" class="form-input" placeholder="Enter your first name" required>
                            <span class="error-message" id="firstName-error">Please enter your first name</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="lastName" class="form-label">Last Name<span class="required">*</span></label>
                            <input type="text" id="lastName" name="lastName" class="form-input" placeholder="Enter your last name" required>
                            <span class="error-message" id="lastName-error">Please enter your last name</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address<span class="required">*</span></label>
                        <div style="display: flex; gap: 10px; align-items: flex-start;">
                            <div style="flex: 1;">
                                <input type="email" id="email" name="email" class="form-input" placeholder="your.email@example.com" required>
                                <span class="error-message" id="email-error">Please enter a valid email address</span>
                                <div id="email-otp-section" style="display: none; margin-top: 10px;">
                                    <input type="text" id="email-otp" class="form-input" placeholder="Enter 6-digit OTP" maxlength="6" pattern="[0-9]{6}">
                                    <button type="button" id="verify-email-otp" class="btn-verify-otp">Verify Email</button>
                                </div>
                                <span class="success-message" id="email-verified" style="display: none; color: #28a745; margin-top: 5px; font-size: 14px;">✓ Email Verified</span>
                            </div>
                            <button type="button" id="send-email-otp" class="btn-send-otp">Send OTP</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone" class="form-label">Phone Number<span class="required">*</span></label>
                            <input type="tel" id="phone" name="phone" class="form-input" placeholder="+91 98765 43210" required pattern="[0-9+\s\-()]{10,15}">
                            <span class="error-message" id="phone-error">Please enter a valid phone number</span>
                        </div>
                        
                        <div class="form-group">
                            <label for="whatsapp" class="form-label">WhatsApp Number<span class="required">*</span></label>
                            <input type="tel" id="whatsapp" name="whatsapp" class="form-input" placeholder="+91 98765 43210" required pattern="[0-9+\s\-()]{10,15}">
                            <span class="error-message" id="whatsapp-error">Please enter a valid WhatsApp number</span>
                        </div>
                    </div>
                    
                    <h2 class="form-section-title" style="margin-top: 40px;">Additional Details</h2>
                    
                    <div class="form-group">
                        <label for="city" class="form-label">City<span class="required">*</span></label>
                        <input type="text" id="city" name="city" class="form-input" placeholder="Enter your city" required>
                        <span class="error-message" id="city-error">Please enter your city</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="category" class="form-label">Which category best describes you?<span class="required">*</span></label>
                        <select id="category" name="category" class="form-select" required>
                            <option value="">Select a category</option>
                            <option value="fashion-graduate">Fashion designing graduate</option>
                            <option value="fashion-enthusiast">Fashion enthusiast</option>
                            <option value="homemaker">Homemaker</option>
                            <option value="boutique-owner">Home boutique owner</option>
                            <option value="other">Other</option>
                        </select>
                        <span class="error-message" id="category-error">Please select a category</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="experience" class="form-label">Do you have any fashion business experience?</label>
                        <select id="experience" name="experience" class="form-select">
                            <option value="">Select an option</option>
                            <option value="none">No experience</option>
                            <option value="beginner">Beginner (0-1 years)</option>
                            <option value="intermediate">Intermediate (1-3 years)</option>
                            <option value="experienced">Experienced (3+ years)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="expectations" class="form-label">What do you hope to learn from this webinar?</label>
                        <textarea id="expectations" name="expectations" class="form-textarea" placeholder="Share your expectations and goals..."></textarea>
                    </div>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="terms" name="terms" class="checkbox-input" required>
                            <label for="terms" class="checkbox-label">I agree to the <a href="pages/terms-conditions.html" target="_blank">Terms & Conditions</a> and <a href="pages/privacy-policy.html" target="_blank">Privacy Policy</a><span class="required">*</span></label>
                        </div>
                        <span class="error-message" id="terms-error" style="margin-left: 32px;">You must agree to the terms and conditions</span>
                        
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="updates" name="updates" class="checkbox-input">
                            <label for="updates" class="checkbox-label">I want to receive updates, tips, and promotional content via email and WhatsApp</label>
                        </div>
                    </div>
                    
                    <div class="payment-section">
                        <h3 class="payment-title">Complete Your Registration</h3>
                        <div class="payment-amount">₹299</div>
                        <p class="payment-description">One-time payment • Limited seats available</p>
                        
                        <div class="payment-features">
                            <div class="payment-feature">3-hour live interactive webinar</div>
                            <div class="payment-feature">Direct Q&A with industry expert</div>
                            <div class="payment-feature">Downloadable resources & materials</div>
                            <div class="payment-feature">Certificate of participation</div>
                            <div class="payment-feature">Lifetime access to recording</div>
                        </div>
                        
                        <button type="submit" id="submit-btn" class="btn-submit">
                            Proceed to Payment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    
    <footer id="footer" class="site-footer">
        <div class="container">
            <div style="margin-bottom: 20px; text-align: center;">
                <a href="pages/privacy-policy.html" style="color: #006478; margin: 0 15px; text-decoration: none;">Privacy Policy</a> |
                <a href="pages/terms-conditions.html" style="color: #006478; margin: 0 15px; text-decoration: none;">Terms & Conditions</a> |
                <a href="pages/refund-policy.html" style="color: #006478; margin: 0 15px; text-decoration: none;">Refund Policy</a> |
                <a href="pages/contact.html" style="color: #006478; margin: 0 15px; text-decoration: none;">Contact Us</a>
            </div>
            <p class="copyright">Copyright © 2025 , The Needles. All rights reserved.</p>
            <p class="disclaimer">This site is not a part of the Meta™ Inc. Additionally, this site is not endorsed by Meta™ in any way. All content provided on this page is for informational and promotional purposes only. Results may vary and are not guaranteed.</p>
        </div>
    </footer>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
// Form validation
function validateForm() {
    let isValid = true;
    
    // Clear all previous errors
    document.querySelectorAll('.error-message').forEach(msg => msg.style.display = 'none');
    document.querySelectorAll('.error').forEach(field => field.classList.remove('error'));
    
    // Validate first name
    const firstName = document.getElementById('firstName');
    if (!firstName.value.trim()) {
        showError('firstName');
        isValid = false;
    }
    
    // Validate last name
    const lastName = document.getElementById('lastName');
    if (!lastName.value.trim()) {
        showError('lastName');
        isValid = false;
    }
    
    // Validate email
    const email = document.getElementById('email');
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email.value.trim() || !emailPattern.test(email.value)) {
        showError('email');
        isValid = false;
    }
    
    // Validate phone
    const phone = document.getElementById('phone');
    if (!phone.value.trim() || phone.value.length < 10) {
        showError('phone');
        isValid = false;
    }
    
    // Validate WhatsApp
    const whatsapp = document.getElementById('whatsapp');
    if (!whatsapp.value.trim() || whatsapp.value.length < 10) {
        showError('whatsapp');
        isValid = false;
    }
    
    // Validate city
    const city = document.getElementById('city');
    if (!city.value.trim()) {
        showError('city');
        isValid = false;
    }
    
    // Validate category
    const category = document.getElementById('category');
    if (!category.value) {
        showError('category');
        isValid = false;
    }
    
    // Validate terms checkbox
    const terms = document.getElementById('terms');
    if (!terms.checked) {
        showError('terms');
        isValid = false;
    }
    
    return isValid;
}

function showError(fieldId) {
    const field = document.getElementById(fieldId);
    const errorMsg = document.getElementById(fieldId + '-error');
    
    if (field) field.classList.add('error');
    if (errorMsg) errorMsg.style.display = 'block';
}

// Function to collect form data
function getFormData() {
    return {
        firstName: document.getElementById('firstName').value.trim(),
        lastName: document.getElementById('lastName').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        whatsapp: document.getElementById('whatsapp').value.trim(),
        city: document.getElementById('city').value.trim(),
        category: document.getElementById('category').value,
        experience: document.getElementById('experience').value,
        expectations: document.getElementById('expectations').value.trim(),
        updates: document.getElementById('updates').checked
    };
}

// Function to validate email and phone with backend
async function validateContactDetails(userData) {
    try {
        const response = await fetch('http://localhost:3000/validate-contact', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: userData.email,
                phone: userData.phone,
                whatsapp: userData.whatsapp
            })
        });
        
        const result = await response.json();
        
        if (!result.success && result.errors) {
            // Show backend validation errors
            if (result.errors.email) {
                showError('email');
                document.getElementById('email-error').textContent = result.errors.email;
                document.getElementById('email-error').style.display = 'block';
            }
            if (result.errors.phone) {
                showError('phone');
                document.getElementById('phone-error').textContent = result.errors.phone;
                document.getElementById('phone-error').style.display = 'block';
            }
            if (result.errors.whatsapp) {
                showError('whatsapp');
                document.getElementById('whatsapp-error').textContent = result.errors.whatsapp;
                document.getElementById('whatsapp-error').style.display = 'block';
            }
            return false;
        }
        
        return true;
    } catch (error) {
        console.error('Validation error:', error);
        alert('Unable to validate contact details. Please check your internet connection and try again.');
        return false;
    }
}

// Function to create order using backend API
async function createRazorpayOrder(userData) {
    try {
        const response = await fetch('http://localhost:3000/create-order', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                amount: 100, // ₹299 in paise
                currency: 'INR',
                receipt: 'webinar_' + Date.now(),
                notes: {
                    webinar: 'Fashion Business Webinar - 10th December 2025',
                    event_type: 'webinar_registration',
                    customer_name: userData.firstName + ' ' + userData.lastName,
                    customer_email: userData.email,
                    customer_phone: userData.phone
                }
            })
        });
        
        const order = await response.json();
        
        if (order.error) {
            throw new Error(order.error);
        }
        
        return order;
    } catch (error) {
        console.error('Error creating order:', error);
        alert('Failed to create order. Please try again.');
        return null;
    }
}

// Function to handle successful payment
function handlePaymentSuccess(response, userData) {
    // Send payment details and user data to backend for verification
    fetch('http://localhost:3000/verify-payment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            razorpay_order_id: response.razorpay_order_id,
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_signature: response.razorpay_signature,
            userData: userData
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            alert('Payment successful! You will receive webinar details via email and WhatsApp.');
            // Redirect to success page
            window.location.href = 'success.html';
        } else {
            alert('Payment verification failed. Please contact support with payment ID: ' + response.razorpay_payment_id);
        }
    })
    .catch(error => {
        console.error('Payment verification error:', error);
        alert('Payment verification failed. Please contact support with payment ID: ' + response.razorpay_payment_id);
    });
}

// Form submission handler
document.getElementById('registration-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Check if email is verified
    if (!emailVerified) {
        alert('Please verify your email before proceeding to payment.');
        return;
    }
    
    // Validate form
    if (!validateForm()) {
        alert('Please fill in all required fields correctly.');
        return;
    }
    
    // Get form data
    const userData = getFormData();
    
    // Disable submit button and show loading state
    const submitBtn = document.getElementById('submit-btn');
    submitBtn.disabled = true;
    submitBtn.innerHTML = 'Validating...';
    
    // Validate contact details with backend
    const isContactValid = await validateContactDetails(userData);
    
    if (!isContactValid) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Proceed to Payment';
        alert('Please correct the errors in your contact details.');
        return;
    }
    
    // Update button text
    submitBtn.innerHTML = 'Processing...';
    
    // Create order
    const order = await createRazorpayOrder(userData);
    
    if (!order) {
        // Reset button state if order creation failed
        submitBtn.disabled = false;
        submitBtn.innerHTML = 'Proceed to Payment';
        return;
    }
    
    // Configure Razorpay options
    var options = {
        "key": "rzp_live_RWvoJlAdc0Vh7T", // Your Razorpay Key ID
        "amount": order.amount,
        "currency": order.currency,
        "name": "The Needles",
        "description": "Fashion Business Webinar Registration",
        "image": "https://example.com/your_logo", // Replace with your logo URL
        "order_id": order.id,
        "handler": function (response) {
            handlePaymentSuccess(response, userData);
        },
        "prefill": {
            "name": userData.firstName + ' ' + userData.lastName,
            "email": userData.email,
            "contact": userData.phone
        },
        "notes": {
            "webinar": "Fashion Business Webinar - 10th December 2025",
            "city": userData.city,
            "category": userData.category
        },
        "theme": {
            "color": "#006478"
        },
        "modal": {
            "ondismiss": function() {
                // Reset button state when payment modal is closed
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Proceed to Payment';
            },
            // Handle payment errors
            "escape": true,
            "backdropclose": false,
            "confirm_close": true
        },
        // Retry configuration
        "retry": {
            "enabled": true,
            "max_count": 3
        },
        // Payment failure handler
        "payment_failed": function(response) {
            console.error('Payment failed:', response);
            
            // Store failure details in sessionStorage for the failed page
            sessionStorage.setItem('paymentError', JSON.stringify({
                code: response.error?.code,
                description: response.error?.description,
                reason: response.error?.reason,
                timestamp: new Date().toISOString()
            }));
            
            // Redirect to payment failed page
            window.location.href = 'payment-failed.html';
        }
    };
    
    var rzp1 = new Razorpay(options);
    
    // Reset button state
    submitBtn.disabled = false;
    submitBtn.innerHTML = 'Proceed to Payment';
    
    // Open Razorpay checkout
    rzp1.open();
});

// Auto-fill WhatsApp number from phone number
document.getElementById('phone').addEventListener('blur', function() {
    const whatsappField = document.getElementById('whatsapp');
    if (!whatsappField.value && this.value) {
        whatsappField.value = this.value;
    }
});

// OTP Verification State
let emailVerified = false;

// Send Email OTP
document.getElementById('send-email-otp').addEventListener('click', async function() {
    const email = document.getElementById('email').value.trim();
    
    if (!email) {
        alert('Please enter your email address');
        return;
    }
    
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        alert('Please enter a valid email address');
        return;
    }
    
    const btn = this;
    btn.disabled = true;
    btn.textContent = 'Sending...';
    
    try {
        const response = await fetch('http://localhost:3000/send-otp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
        });
        
        const result = await response.json();
        
        if (result.success) {
            document.getElementById('email-otp-section').style.display = 'block';
            alert('OTP sent to your email. Please check your inbox.');
            btn.textContent = 'Resend OTP';
            setTimeout(() => { btn.disabled = false; }, 60000); // Re-enable after 1 minute
        } else {
            alert(result.message || 'Failed to send OTP');
            btn.disabled = false;
            btn.textContent = 'Send OTP';
        }
    } catch (error) {
        console.error('Send email OTP error:', error);
        alert('Failed to send OTP. Please try again.');
        btn.disabled = false;
        btn.textContent = 'Send OTP';
    }
});

// Verify Email OTP
document.getElementById('verify-email-otp').addEventListener('click', async function() {
    const email = document.getElementById('email').value.trim();
    const otp = document.getElementById('email-otp').value.trim();
    
    if (!otp || otp.length !== 6) {
        alert('Please enter the 6-digit OTP');
        return;
    }
    
    const btn = this;
    btn.disabled = true;
    btn.textContent = 'Verifying...';
    
    try {
        const response = await fetch('http://localhost:3000/verify-otp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, otp })
        });
        
        const result = await response.json();
        
        if (result.success) {
            emailVerified = true;
            document.getElementById('email-verified').style.display = 'block';
            document.getElementById('email-otp-section').style.display = 'none';
            document.getElementById('email').readOnly = true;
            document.getElementById('send-email-otp').style.display = 'none';
            alert('Email verified successfully!');
        } else {
            alert(result.message || 'Invalid OTP');
            btn.disabled = false;
            btn.textContent = 'Verify Email';
        }
    } catch (error) {
        console.error('Verify email OTP error:', error);
        alert('Failed to verify OTP. Please try again.');
        btn.disabled = false;
        btn.textContent = 'Verify Email';
    }
});
</script>
</body>
</html>
